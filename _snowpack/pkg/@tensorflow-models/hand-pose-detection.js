import { h as hands } from '../common/hands-40b6c800.js';
import { l as loadGraphModel } from '../common/graph_model-bdc9e46a.js';
import '../common/base_side_effects-da8c2899.js';
import { t as tensor1d, s as squeeze, i as image, e as expandDims, a as tensor2d, b as add, c as slice, d as div, f as exp, g as sub, h as concat, j as clipByValue } from '../common/ops-8ba8b32b.js';
import { T as Tensor, c as cast, m as mul, r as reshape, s as sigmoid } from '../common/fused_util-14ebb22b.js';
import { t as tidy, d as dispose } from '../common/non_max_suppression_impl-7c2a8307.js';
import { f as fromPixels } from '../common/browser-18843eb3.js';
import { a as assert } from '../common/util_base-b10b4a9e.js';
import '../common/_commonjsHelpers-a3307dcf.js';
import '../common/http-ca16bfe6.js';
import '../common/index-c946ae75.js';
import '../common/long-293d795f.js';

/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */
var I=function(){return (I=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function T(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{s(i.next(t));}catch(t){o(t);}}function h(t){try{s(i.throw(t));}catch(t){o(t);}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e);}))).then(a,h);}s((i=i.apply(t,e||[])).next());}))}function S(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function h(o){return function(h){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a);}catch(t){o=[6,t],i=0;}finally{n=r=0;}if(5&o[0])throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}([o,h])}}}var k=["wrist","thumb_cmc","thumb_mcp","thumb_ip","thumb_tip","index_finger_mcp","index_finger_pip","index_finger_dip","index_finger_tip","middle_finger_mcp","middle_finger_pip","middle_finger_dip","middle_finger_tip","ring_finger_mcp","ring_finger_pip","ring_finger_dip","ring_finger_tip","pinky_finger_mcp","pinky_finger_pip","pinky_finger_dip","pinky_finger_tip"],_={runtime:"mediapipe",maxHands:2,modelType:"full"};var C=function(){function e(e){var n,i=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.handsSolution=new hands.Hands({locateFile:function(t,n){return e.solutionPath?e.solutionPath.replace(/\/+$/,"")+"/"+t:n+"/"+t}}),e.modelType){case"lite":n=0;break;case"full":default:n=1;}this.handsSolution.setOptions({modelComplexity:n,selfieMode:this.selfieMode,maxNumHands:e.maxHands}),this.handsSolution.onResults((function(t){if(i.height=t.image.height,i.width=t.image.width,i.hands=[],null!==t.multiHandLandmarks)for(var e=t.multiHandedness,n=t.multiHandLandmarks,r=t.multiHandWorldLandmarks,o=0;o<e.length;o++)i.hands.push(I({},i.translateOutput(n[o],r[o]),{score:e[o].score,handedness:e[o].label}));}));}return e.prototype.translateOutput=function(t,e){var n=this;return {keypoints:t.map((function(t,e){return {x:t.x*n.width,y:t.y*n.height,score:t.visibility,name:k[e]}})),keypoints3D:e.map((function(t,e){return {x:t.x,y:t.y,z:t.z,score:t.visibility,name:k[e]}}))}},e.prototype.estimateHands=function(t,e){return T(this,void 0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.handsSolution.setOptions({selfieMode:this.selfieMode})),[4,this.handsSolution.send({image:t})];case 1:return n.sent(),[2,this.hands]}}))}))},e.prototype.dispose=function(){this.handsSolution.close();},e.prototype.reset=function(){this.handsSolution.reset(),this.width=0,this.height=0,this.hands=null,this.selfieMode=!1;},e.prototype.initialize=function(){return this.handsSolution.initialize()},e}();function H(t){return T(this,void 0,void 0,(function(){var e,n;return S(this,(function(i){switch(i.label){case 0:return e=function(t){if(null==t)return I({},_);var e=I({},t);return e.runtime="mediapipe",null==e.maxHands&&(e.maxHands=_.maxHands),null==e.modelType&&(e.modelType=_.modelType),e}(t),[4,(n=new C(e)).initialize()];case 1:return i.sent(),[2,n]}}))}))}function z(t){return t.width*t.height}function O(t){var e=t.xCenter-t.width/2,n=e+t.width,i=t.yCenter-t.height/2;return {xMin:e,xMax:n,yMin:i,yMax:i+t.height,width:t.width,height:t.height}}function L(t,e){var n=O(t),i=O(e);if(!function(t,e){return !(t.xMax<e.xMin||e.xMax<t.xMin||t.yMax<e.yMin||e.yMax<t.yMin)}(n,i))return 0;var r=z(function(t,e){var n=Math.max(t.xMin,e.xMin),i=Math.min(t.xMax,e.xMax),r=Math.max(t.yMin,e.yMin),o=Math.min(t.yMax,e.yMax);return {xMin:n,xMax:i,yMin:r,yMax:o,width:Math.max(i-n,0),height:Math.max(o-r,0)}}(n,i)),o=z(n)+z(i)-r;return o>0?r/o:0}function N(t){return t instanceof Tensor?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function B(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function R(t){return t instanceof Tensor?t:fromPixels(t)}function E(t,e){assert(0!==t.width,(function(){return e+" width cannot be 0."})),assert(0!==t.height,(function(){return e+" height cannot be 0."}));}function P(t,e,n){var i=e.inputResolution,r=e.keepAspectRatio,l=N(t),d=function(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}}(l,n),c=function(t,e,n){if(void 0===n&&(n=!1),!n)return {top:0,left:0,right:0,bottom:0};var i=e.height,r=e.width;E(e,"targetSize"),E(t,"roi");var o,a,h=i/r,s=t.height/t.width,u=0,l=0;return h>s?(o=t.width,a=t.width*h,l=(1-s/h)/2):(o=t.height/h,a=t.height,u=(1-h/s)/2),t.width=o,t.height=a,{top:l,left:u,right:u,bottom:l}}(d,i,r);return {imageTensor:tidy((function(){var e=R(t),n=tensor2d(function(t,e,n,i){E(i,"inputResolution");var r=1/e.width,o=1/e.height,a=t.xCenter,h=t.yCenter,s=Math.cos(t.rotation),u=Math.sin(t.rotation),l=n?-1:1,d=t.width,c=t.height;return [1/i.width*d*s*l*r*e.width,1/i.height*-c*u*r*e.width,(-.5*d*s*l+.5*c*u+a)*r*e.width,1/i.width*d*u*l*o*e.height,1/i.height*c*s*o*e.height,(-.5*c*s-.5*d*u*l+h)*o*e.height,0,0]}(d,l,!1,i),[1,8]);return image.transform(expandDims(cast(e,"float32")),n,"bilinear","nearest",0,[i.height,i.width])})),padding:c}}function V(t,e,n,i){return 1===i?.5*(t+e):t+(e-t)*n/(i-1)}function D(t,e,n){var i=t.locationData.relativeBoundingBox,r=function(t,e,n){var i,r=t.locationData,o=n.rotationVectorStartKeypointIndex,a=n.rotationVectorEndKeypointIndex;i=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var h=r.relativeKeypoints[o].x*e.width,s=r.relativeKeypoints[o].y*e.height,u=r.relativeKeypoints[a].x*e.width,l=r.relativeKeypoints[a].y*e.height;return B(i-Math.atan2(-(l-s),u-h))}(t,e,n);return {xCenter:i.xMin+i.width/2,yCenter:i.yMin+i.height/2,width:i.width,height:i.height,rotation:r}}function K(t,e){return tidy((function(){var n=function(t){return tidy((function(){return [slice(t,[0,0,0],[1,-1,1]),slice(t,[0,0,1],[1,-1,-1])]}))}(e.predict(t)),i=n[0],r=n[1];return {boxes:squeeze(r),logits:squeeze(i)}}))}function A(t,e,n,i){return T(this,void 0,void 0,(function(){var r,o,s,u,l;return S(this,(function(d){switch(d.label){case 0:return t.sort((function(t,e){return Math.max.apply(Math,e.score)-Math.max.apply(Math,t.score)})),r=tensor2d(t.map((function(t){return [t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),o=tensor1d(t.map((function(t){return t.score[0]}))),[4,image.nonMaxSuppressionAsync(r,o,e,n,i)];case 1:return [4,(s=d.sent()).array()];case 2:return u=d.sent(),l=t.filter((function(t,e){return u.indexOf(e)>-1})),dispose([r,o,s]),[2,l]}}))}))}function Y(t,e){return t.map((function(t){var n=I({},t,{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))}function F(t,e){var n=function(t,e,n,i){var r=e-t,o=i-n;if(0===r)throw new Error("Original min and max are both "+t+", range cannot be 0.");var a=o/r;return {scale:a,offset:n-t*a}}(0,255,e[0],e[1]);return tidy((function(){return add(mul(t,n.scale),n.offset)}))}function j(t,e,n){return T(this,void 0,void 0,(function(){var i,r,a,h,s;return S(this,(function(u){switch(u.label){case 0:return i=t[0],r=t[1],a=function(t,e,n){return tidy((function(){var i,r,o,a;n.reverseOutputOrder?(r=squeeze(slice(t,[0,n.boxCoordOffset+0],[-1,1])),i=squeeze(slice(t,[0,n.boxCoordOffset+1],[-1,1])),a=squeeze(slice(t,[0,n.boxCoordOffset+2],[-1,1])),o=squeeze(slice(t,[0,n.boxCoordOffset+3],[-1,1]))):(i=squeeze(slice(t,[0,n.boxCoordOffset+0],[-1,1])),r=squeeze(slice(t,[0,n.boxCoordOffset+1],[-1,1])),o=squeeze(slice(t,[0,n.boxCoordOffset+2],[-1,1])),a=squeeze(slice(t,[0,n.boxCoordOffset+3],[-1,1]))),r=add(mul(div(r,n.xScale),e.w),e.x),i=add(mul(div(i,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(o=mul(exp(div(o,n.hScale)),e.h),a=mul(exp(div(a,n.wScale)),e.w)):(o=mul(div(o,n.hScale),e.h),a=mul(div(a,n.wScale),e.h));var h=sub(i,div(o,2)),s=sub(r,div(a,2)),u=add(i,div(o,2)),c=add(r,div(a,2)),f=concat([reshape(h,[n.numBoxes,1]),reshape(s,[n.numBoxes,1]),reshape(u,[n.numBoxes,1]),reshape(c,[n.numBoxes,1])],1);if(n.numKeypoints)for(var w=0;w<n.numKeypoints;++w){var b=n.keypointCoordOffset+w*n.numValuesPerKeypoint,I=void 0,T=void 0;n.reverseOutputOrder?(I=squeeze(slice(t,[0,b],[-1,1])),T=squeeze(slice(t,[0,b+1],[-1,1]))):(T=squeeze(slice(t,[0,b],[-1,1])),I=squeeze(slice(t,[0,b+1],[-1,1])));var S=add(mul(div(I,n.xScale),e.w),e.x),k=add(mul(div(T,n.yScale),e.h),e.y);f=concat([f,reshape(S,[n.numBoxes,1]),reshape(k,[n.numBoxes,1])],1);}return f}))}(r,e,n),h=tidy((function(){var t=i;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=clipByValue(i,-n.scoreClippingThresh,n.scoreClippingThresh)),t=sigmoid(t)):t})),[4,U(a,h,n)];case 1:return s=u.sent(),dispose([a,h]),[2,s]}}))}))}function U(t,e,n){return T(this,void 0,void 0,(function(){var i,r,o,a,h,s,u,l,d,c,f,p;return S(this,(function(m){switch(m.label){case 0:return i=[],[4,t.data()];case 1:return r=m.sent(),[4,e.data()];case 2:for(o=m.sent(),a=0;a<n.numBoxes;++a)if(!(null!=n.minScoreThresh&&o[a]<n.minScoreThresh||(h=a*n.numCoords,s=W(r[h+0],r[h+1],r[h+2],r[h+3],o[a],n.flipVertically,a),(u=s.locationData.relativeBoundingBox).width<0||u.height<0))){if(n.numKeypoints>0)for((l=s.locationData).relativeKeypoints=[],d=n.numKeypoints*n.numValuesPerKeypoint,c=0;c<d;c+=n.numValuesPerKeypoint)f=h+n.keypointCoordOffset+c,p={x:r[f+0],y:n.flipVertically?1-r[f+1]:r[f+1]},l.relativeKeypoints.push(p);i.push(s);}return [2,i]}}))}))}function W(t,e,n,i,r,o,a){return {score:[r],ind:a,locationData:{relativeBoundingBox:{xMin:e,yMin:o?1-n:t,xMax:i,yMax:o?1-t:n,width:i-e,height:n-t}}}}function X(t,e){return "none"===t?e:function(t){return 1/(1+Math.exp(-t))}(e)}function q(t,e,n,i){return T(this,void 0,void 0,(function(){var r,o,a,h,s,u,l,d;return S(this,(function(c){switch(c.label){case 0:return n=n||e.flipHorizontally||!1,i=i||e.flipVertically||!1,r=t.size,o=r/e.numLandmarks,[4,t.data()];case 1:for(a=c.sent(),h=[],s=0;s<e.numLandmarks;++s)u=s*o,(d={x:0,y:0}).x=n?e.inputImageWidth-a[u]:a[u],o>1&&(d.y=i?e.inputImageHeight-a[u+1]:a[u+1]),o>2&&(d.z=a[u+2]),o>3&&(d.score=X(e.visibilityActivation,a[u+3])),h.push(d);for(l=0;l<h.length;++l)(d=h[l]).x=d.x/e.inputImageWidth,d.y=d.y/e.inputImageHeight,d.z=d.z/e.inputImageWidth/(e.normalizeZ||1);return [2,h]}}))}))}function G(t,e,n){var i=t.width,r=t.height,o=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=function(t,e){null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180);return B(t)}(o,n)),0===o)t.xCenter=t.xCenter+i*n.shiftX,t.yCenter=t.yCenter+r*n.shiftY;else {var a=(e.width*i*n.shiftX*Math.cos(o)-e.height*r*n.shiftY*Math.sin(o))/e.width,h=(e.width*i*n.shiftX*Math.sin(o)+e.height*r*n.shiftY*Math.cos(o))/e.height;t.xCenter=t.xCenter+a,t.yCenter=t.yCenter+h;}if(n.squareLong){var s=Math.max(i*e.width,r*e.height);i=s/e.width,r=s/e.height;}else if(n.squareShort){var u=Math.min(i*e.width,r*e.height);i=u/e.width,r=u/e.height;}return t.width=i*n.scaleX,t.height=r*n.scaleY,t}function Z(t,e){for(var n=function(t,e){var n=t[0].x*e.width,i=t[0].y*e.height,r=(t[4].x+t[8].x)/2,o=(t[4].y+t[8].y)/2;return r=(r+t[6].x)/2*e.width,o=(o+t[6].y)/2*e.height,B(Math.PI/2-Math.atan2(-(o-i),r-n))}(t,e),i=B(-n),r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,s=0,u=t;s<u.length;s++){var l=(g=u[s]).x,d=g.y;r=Math.min(r,l),o=Math.max(o,l),a=Math.min(a,d),h=Math.max(h,d);}var c=(o+r)/2,f=(h+a)/2;r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(var p=0,m=t;p<m.length;p++){var g,y=((g=m[p]).x-c)*e.width,x=(g.y-f)*e.height,v=y*Math.cos(i)-x*Math.sin(i),M=y*Math.sin(i)+x*Math.cos(i);r=Math.min(r,v),o=Math.max(o,v),a=Math.min(a,M),h=Math.max(h,M);}var w=(o+r)/2,b=(h+a)/2,I=w*Math.cos(n)-b*Math.sin(n)+e.width*c,T=w*Math.sin(n)+b*Math.cos(n)+e.height*f,S=(o-r)/e.width,k=(h-a)/e.height;return {xCenter:I/e.width,yCenter:T/e.height,width:S,height:k,rotation:n}}var $={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},J={runtime:"tfjs",modelType:"full",maxHands:2,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/full/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/full/1"},Q={flipHorizontal:!1,staticImageMode:!1},tt={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2016,numCoords:18,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:7,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.5},et=-1,nt=.3,it={shiftX:0,shiftY:-.5,scaleX:2.6,scaleY:2.6,squareLong:!0},rt={shiftX:0,shiftY:-.1,scaleX:2,scaleY:2,squareLong:!0},ot={inputResolution:{width:192,height:192},keepAspectRatio:!0},at={inputResolution:{width:224,height:224},keepAspectRatio:!0},ht={numLandmarks:21,inputImageWidth:224,inputImageHeight:224,normalizeZ:.4,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},st={numLandmarks:21,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1};var ut,lt=function(){function t(t,e,n){this.detectorModel=t,this.landmarkModel=e,this.maxHands=n,this.prevHandRectsFromLandmarks=null,this.anchors=function(t){for(var e=[],n=0;n<t.numLayers;){for(var i=[],r=[],o=[],a=[],h=n;h<t.strides.length&&t.strides[h]===t.strides[n];){var s=V(t.minScale,t.maxScale,h,t.strides.length);if(0===h&&t.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),a.push(.1),a.push(s),a.push(s);else {for(var u=0;u<t.aspectRatios.length;++u)o.push(t.aspectRatios[u]),a.push(s);if(t.interpolatedScaleAspectRatio>0){var l=h===t.strides.length-1?1:V(t.minScale,t.maxScale,h+1,t.strides.length);a.push(Math.sqrt(s*l)),o.push(t.interpolatedScaleAspectRatio);}}h++;}for(var d=0;d<o.length;++d){var c=Math.sqrt(o[d]);i.push(a[d]/c),r.push(a[d]*c);}var f=0,p=0;if(t.featureMapHeight.length>0)f=t.featureMapHeight[n],p=t.featureMapWidth[n];else {var m=t.strides[n];f=Math.ceil(t.inputSizeHeight/m),p=Math.ceil(t.inputSizeWidth/m);}for(var g=0;g<f;++g)for(var y=0;y<p;++y)for(var x=0;x<i.length;++x){var v={xCenter:(y+t.anchorOffsetX)/p,yCenter:(g+t.anchorOffsetY)/f,width:0,height:0};t.fixedAnchorSize?(v.width=1,v.height=1):(v.width=r[x],v.height=i[x]),e.push(v);}n=h;}return e}($);var i=tensor1d(this.anchors.map((function(t){return t.width}))),r=tensor1d(this.anchors.map((function(t){return t.height}))),o=tensor1d(this.anchors.map((function(t){return t.xCenter}))),a=tensor1d(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:o,y:a,w:i,h:r};}return t.prototype.estimateHands=function(t,e){return T(this,void 0,void 0,(function(){var n,i,r,a,l,c,f,p,m,g,y,x,v,M,w,b,T,_,C=this;return S(this,(function(S){switch(S.label){case 0:return n=function(t){if(null==t)return I({},Q);var e=I({},t);return null==e.flipHorizontal&&(e.flipHorizontal=Q.flipHorizontal),null==e.staticImageMode&&(e.staticImageMode=Q.staticImageMode),e}(e),null==t?(this.reset(),[2,[]]):(i=N(t),r=tidy((function(){var e=cast(R(t),"float32");if(n.flipHorizontal){e=squeeze(image.flipLeftRight(expandDims(e,0)),[0]);}return e})),a=this.prevHandRectsFromLandmarks,n.staticImageMode||null==a||a.length<this.maxHands?[4,this.detectPalm(r)]:[3,2]);case 1:return 0===(c=S.sent()).length?(this.reset(),r.dispose(),[2,[]]):(f=c.map((function(t){return C.palmDetectionToRoi(t,i)})),l=f,[3,3]);case 2:l=a,S.label=3;case 3:return H=.5,z=[],[l].forEach((function(t){return t.forEach((function(t){(z=z.filter((function(e){return L(t,e)<=H}))).push(t);}))})),l=z,[4,Promise.all(l.map((function(t){return C.handLandmarks(t,r)})))];case 4:for(p=S.sent(),m=[],this.prevHandRectsFromLandmarks=[],g=0,y=p;g<y.length;g++)null!=(x=y[g])&&(v=x.landmarks,M=x.worldLandmarks,w=x.handScore,b=x.handedness,this.prevHandRectsFromLandmarks.push(this.handLandmarksToRoi(v,i)),null!=(T=Y(v,i))&&T.forEach((function(t,e){delete t.z,t.name=k[e];})),null!=(_=M)&&_.forEach((function(t,e){t.name=k[e];})),m.push({keypoints:T,keypoints3D:_,handedness:b,score:w}));return r.dispose(),[2,m]}var H,z;}))}))},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),dispose([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h]);},t.prototype.reset=function(){this.prevHandRectsFromLandmarks=null;},t.prototype.detectPalm=function(t){return T(this,void 0,void 0,(function(){var e,n,i,r,o,a,h,s,u,l;return S(this,(function(d){switch(d.label){case 0:return e=P(t,ot),n=e.imageTensor,i=e.padding,r=F(n,[0,1]),o=K(r,this.detectorModel),a=o.boxes,[4,j([h=o.logits,a],this.anchorTensor,tt)];case 1:return 0===(s=d.sent()).length?(dispose([n,r,h,a]),[2,s]):[4,A(s,this.maxHands,nt,et)];case 2:return u=d.sent(),l=function(t,e){void 0===t&&(t=[]);for(var n=e.left,i=e.top,r=e.left+e.right,o=e.top+e.bottom,a=0;a<t.length;a++){var h=t[a],s=h.locationData.relativeBoundingBox,u=(s.xMin-n)/(1-r),l=(s.yMin-i)/(1-o),d=s.width/(1-r),c=s.height/(1-o);s.xMin=u,s.yMin=l,s.width=d,s.height=c;for(var f=0;f<h.locationData.relativeKeypoints.length;++f){var p=h.locationData.relativeKeypoints[f],m=(p.x-n)/(1-r),g=(p.y-i)/(1-o);p.x=m,p.y=g;}}return t}(u,i),dispose([n,r,h,a]),[2,l]}}))}))},t.prototype.palmDetectionToRoi=function(t,e){return G(D(t,e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:2,rotationVectorTargetAngleDegree:90}),e,it)},t.prototype.handLandmarks=function(t,e){return T(this,void 0,void 0,(function(){var n,i,r,o,a,h,s,u,l,d,f,p,m,g,y,x,v;return S(this,(function(M){switch(M.label){case 0:return n=P(e,at,t),i=n.imageTensor,r=n.padding,o=F(i,[0,1]),a=this.landmarkModel.execute(o,["Identity_2:0","Identity_1:0","Identity:0","Identity_3:0"]),h=a[0],s=a[1],u=a[2],l=a[3],[4,s.data()];case 1:return (d=M.sent()[0])<.5?(dispose(a),dispose([i,o]),[2,null]):[4,u.data()];case 2:return f=M.sent()[0],p=f>=.5?"Left":"Right",[4,q(h,ht)];case 3:return m=M.sent(),[4,q(l,st)];case 4:return g=M.sent(),y=function(t,e){var n=e.left,i=e.top,r=e.left+e.right,o=e.top+e.bottom;return t.map((function(t){return I({},t,{x:(t.x-n)/(1-r),y:(t.y-i)/(1-o),z:t.z/(1-r)})}))}(m,r),x=function(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var i=[],r=0,o=t;r<o.length;r++){var a=o[r],h=a.x-.5,s=a.y-.5,u=n.ignoreRotation?0:e.rotation,l=Math.cos(u)*h-Math.sin(u)*s,d=Math.sin(u)*h+Math.cos(u)*s;l=l*e.width+e.xCenter,d=d*e.height+e.yCenter;var c=a.z*e.width,f=I({},a);f.x=l,f.y=d,f.z=c,i.push(f);}return i}(y,t),v=function(t,e){for(var n=[],i=0,r=t;i<r.length;i++){var o=r[i],a=o.x,h=o.y,s=e.rotation,u=Math.cos(s)*a-Math.sin(s)*h,l=Math.sin(s)*a+Math.cos(s)*h,d=I({},o);d.x=u,d.y=l,n.push(d);}return n}(g,t),dispose(a),dispose([i,o]),[2,{landmarks:x,worldLandmarks:v,handScore:d,handedness:p}]}}))}))},t.prototype.handLandmarksToRoi=function(t,e){return G(Z([].concat(t.slice(0,4),t.slice(5,7),t.slice(9,11),t.slice(13,15),t.slice(17,19)),e),e,rt)},t}();function dt(t){return T(this,void 0,void 0,(function(){var n,i,r,o,a,h;return S(this,(function(s){switch(s.label){case 0:return n=function(t){if(null==t)return I({},J);var e=I({},t);if(e.runtime="tfjs",null==e.maxHands&&(e.maxHands=J.maxHands),null==e.modelType&&(e.modelType=J.modelType),"lite"!==e.modelType&&"full"!==e.modelType)throw new Error("Model type must be one of lite or full, but got "+e.modelType);if(null==e.detectorModelUrl)switch(e.modelType){case"lite":e.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/lite/1";break;case"full":default:e.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/full/1";}if(null==e.landmarkModelUrl)switch(e.modelType){case"lite":e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/lite/1";break;case"full":default:e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/full/1";}return e}(t),i=n.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r=n.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([loadGraphModel(n.detectorModelUrl,{fromTFHub:i}),loadGraphModel(n.landmarkModelUrl,{fromTFHub:r})])];case 1:return o=s.sent(),a=o[0],h=o[1],[2,new lt(a,h,n.maxHands)]}}))}))}function ct(t,e){return T(this,void 0,void 0,(function(){var n,i;return S(this,(function(r){switch(t){case ut.MediaPipeHands:if(i=void 0,null!=(n=e)){if("tfjs"===n.runtime)return [2,dt(n)];if("mediapipe"===n.runtime)return [2,H(n)];i=n.runtime;}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+i);default:throw new Error(t+" is not a supported model name.")}}))}))}!function(t){t.MediaPipeHands="MediaPipeHands";}(ut||(ut={}));

export { ut as SupportedModels, ct as createDetector };
